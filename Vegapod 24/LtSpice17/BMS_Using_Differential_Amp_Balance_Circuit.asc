Version 4
SHEET 1 880 680
WIRE -432 48 -464 48
WIRE -128 48 -352 48
WIRE 288 48 -128 48
WIRE 624 48 288 48
WIRE 384 128 288 128
WIRE 80 144 32 144
WIRE 96 144 80 144
WIRE -128 176 -128 48
WIRE -32 176 -32 112
WIRE -32 176 -48 176
WIRE -464 192 -464 48
WIRE -160 192 -464 192
WIRE -96 208 -96 112
WIRE -48 208 -48 176
WIRE 32 208 32 144
WIRE 160 208 160 192
WIRE 160 208 80 208
WIRE 416 208 288 208
WIRE -208 224 -336 224
WIRE -160 224 -208 224
WIRE 640 224 560 224
WIRE 416 240 416 208
WIRE 464 240 416 240
WIRE 384 272 384 128
WIRE 416 272 384 272
WIRE 624 272 624 48
WIRE 640 272 624 272
WIRE -336 288 -336 224
WIRE -208 288 -208 224
WIRE 544 288 544 240
WIRE 560 288 560 224
WIRE 560 288 544 288
WIRE 608 288 560 288
WIRE 720 304 720 224
WIRE 720 304 672 304
WIRE 752 304 720 304
WIRE 416 320 416 272
WIRE 464 320 416 320
WIRE 608 320 544 320
WIRE -464 352 -464 192
WIRE 544 400 544 320
WIRE 640 400 640 336
WIRE 640 400 624 400
WIRE 240 448 240 96
WIRE 288 448 240 448
WIRE -464 528 -464 480
WIRE -336 528 -336 368
WIRE -336 528 -464 528
WIRE -208 528 -208 368
WIRE -208 528 -336 528
WIRE -128 528 -128 240
WIRE -128 528 -208 528
WIRE 160 528 160 208
WIRE 160 528 -128 528
WIRE 288 528 160 528
WIRE 640 528 640 400
WIRE 640 528 288 528
FLAG -208 528 0
SYMBOL voltage 288 32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 3.7
SYMBOL voltage 288 112 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 3.7
SYMBOL voltage 288 192 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value 3.7
SYMBOL voltage 288 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value 3.7
SYMBOL voltage 288 352 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 3.7
SYMBOL voltage 288 432 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 3.7
SYMBOL res -224 272 R0
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL npn 96 96 R0
SYMATTR InstName Q1
SYMBOL res 256 80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 47
SYMBOL res 48 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 2.2k
SYMBOL diode 96 208 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL OpAmps\\UniversalOpAmp4 -128 208 R0
SYMATTR InstName U1
SYMBOL diode -96 128 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D2
SYMBOL diode -480 416 R0
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res -336 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL diode -480 352 R0
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL voltage -336 272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value PULSE(0 5 0 0 0 1m 10m)
SYMBOL OpAmps\\UniversalOpAmp4 640 304 R0
SYMATTR InstName U2
SYMBOL res 560 304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10k
SYMATTR SpiceLine tol=5
SYMBOL res 560 224 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 10k
SYMATTR SpiceLine tol=5
SYMBOL res 736 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 10k
SYMATTR SpiceLine tol=5
SYMBOL res 640 384 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 10k
SYMATTR SpiceLine tol=5
TEXT -496 552 Left 2 !.tran 1s
